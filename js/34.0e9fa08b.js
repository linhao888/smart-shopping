"use strict";(self["webpackChunksmart_shopping"]=self["webpackChunksmart_shopping"]||[]).push([[34],{7653:function(t,e,s){s.r(e),s.d(e,{default:function(){return u}});var i=function(){var t=this,e=t._self._c;return e("div",[e("van-nav-bar",{attrs:{title:"会员登录","left-text":"返回","left-arrow":""},on:{"click-left":function(e){return t.$router.go(-1)}}}),e("div",{staticClass:"main"},[t._m(0),e("van-form",[e("van-field",{staticStyle:{height:"52px","line-height":"32px"},attrs:{name:"phone-num",placeholder:"请输入手机号",rules:[{pattern:t.phonevali,message:"请填写手机号"}]},model:{value:t.phoneNum,callback:function(e){t.phoneNum=e},expression:"phoneNum"}}),e("van-field",{staticStyle:{height:"52px","line-height":"32px"},attrs:{name:"image-code",center:"",clearable:"",placeholder:"请输入短信验证码"},scopedSlots:t._u([{key:"right-icon",fn:function(){return[e("img",{directives:[{name:"show",rawName:"v-show",value:t.imgCodeUrl,expression:"imgCodeUrl"}],staticStyle:{width:"77px",height:"32px","vertical-align":"middle"},attrs:{src:t.imgCodeUrl,alt:"icon"},on:{click:function(e){return t.getImgCode()}}})]},proxy:!0}]),model:{value:t.imgCode,callback:function(e){t.imgCode=e},expression:"imgCode"}}),e("van-field",{staticStyle:{height:"52px","line-height":"32px"},attrs:{name:"sms",center:"",clearable:"",placeholder:"请输入短信验证码"},scopedSlots:t._u([{key:"button",fn:function(){return[e("van-button",{attrs:{size:"small",type:"primary",disabled:t.smsBtnState},on:{click:function(e){return t.getSmsCode()}}},[t._v(t._s(t.totalSecon===t.nowSecon?"发送验证码":`${t.nowSecon}秒后再次获取`))])]},proxy:!0}]),model:{value:t.sms,callback:function(e){t.sms=e},expression:"sms"}}),e("div",{staticStyle:{margin:"16px"}},[e("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"},on:{click:function(e){return t.login()}}},[t._v("登录")])],1)],1)],1)],1)},n=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-title"},[e("h1",[t._v("手机号登录")]),e("span",[t._v("手机号未注册将自动注册")])])}],a=s(5720);const o=()=>a.A.get("/captcha/image"),l=(t,e,s)=>a.A.post("/captcha/sendSmsCaptcha",{form:{captchaCode:t,captchaKey:e,mobile:s}}),r=(t,e)=>a.A.post("/passport/login",{form:{isParty:!1,mobile:t,partyData:{},smsCode:e}});var c={name:"LoginIndex",data(){return{phoneNum:"",phonevali:/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/,imgCode:"",imgCodeUrl:"",imgCodeKey:"",sms:"",totalSecon:30,nowSecon:30,smsBtnState:!1,intervalId:null}},created(){this.getImgCode()},destroyed(){clearInterval(this.intervalId)},methods:{validator(){return this.phonevali.test(this.phoneNum)?!!/^\w{4}$/.test(this.imgCode)||(this.$toast("请输入正确的图形验证码"),!1):(this.$toast("请填写正确的手机号"),!1)},async getImgCode(){const{data:{base64:t,key:e}}=await o();this.imgCodeUrl=t,this.imgCodeKey=e},async getSmsCode(){if(!this.validator())return;const t=await l(this.imgCode,this.imgCodeKey,this.phoneNum);this.$toast("后端暂未开通该服务，验证码统一为246810"),console.log("getsms",t),this.nowSecon--,this.smsBtnState=!0,this.intervalId=setInterval((()=>{this.nowSecon--,this.nowSecon<=0&&(clearInterval(this.intervalId),this.intervalId=null,this.nowSecon=this.totalSecon,this.smsBtnState=!1)}),1e3)},async login(){if(this.validator())if(/^\d{6}$/.test(this.sms))try{const t=await r(this.phoneNum,this.sms);this.$store.commit("user/setUserInfo",t.data),this.$toast.success("登录成功");const e=this.$route.query.backUrl||"/";this.$router.replace(e)}catch(t){this.$dialog.alert({title:"提示",message:"手机号请使用13488888888"}).then((()=>{}))}else this.$toast("验证码格式有误")}}},h=c,m=s(1656),d=(0,m.A)(h,i,n,!1,null,"69ff5298",null),u=d.exports}}]);
//# sourceMappingURL=34.0e9fa08b.js.map